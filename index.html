<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Transition fluide automatique</title>
<style>
  html,body{
    margin:0;padding:0;
    height:300vh; /* la hauteur sera adapt√©e dynamiquement */
    overflow-x:hidden;
    font-family:Arial,sans-serif;
    color:#fff;
  }

  #bg{
    position:fixed;inset:0;z-index:-1;
    background-size:cover;background-position:center;background-repeat:no-repeat;
    opacity:0;filter:blur(12px);
    transition:opacity 1s ease, filter 1s ease;
  }

  section{
    height:100vh;
    display:flex;align-items:center;justify-content:center;
    font-size:2rem;text-shadow:0 2px 8px rgba(0,0,0,0.8);
  }
</style>
</head>
<body>

<div id="bg"></div>

<main id="slides">
  <section data-bg="https://thumbs.dreamstime.com/z/beau-d%C3%A9grad%C3%A9-plage-coucher-de-soleil-paysage-belle-avec-rose-violet-et-bleu-couleur-design-253694928.jpg?ct=jpeg">Section 1</section>
  <section data-bg="https://thumbs.dreamstime.com/z/plage-de-bord-de-mer-avec-concept-de-vacances-d-%C3%A9t%C3%A9-de-paysage-de-bord-de-la-mer-de-coucher-du-soleil-d-h-tel-de-villa-le-beau-96769815.jpg?ct=jpeg">Section 2</section>
  <section data-bg="https://thumbs.dreamstime.com/z/plage-d-hawa%C3%AF-15257897.jpg?ct=jpeg">Section 3</section>
</main>

<script>
(() => {
  const bg = document.getElementById("bg");
  const sections = document.querySelectorAll("#slides section[data-bg]");
  const images = Array.from(sections).map(s => s.dataset.bg);
  const n = images.length;
  document.body.style.height = n * 100 + "vh"; // adapte la hauteur

  let currentIndex = -1;

  function changeBackground(idx){
    if(idx === currentIndex) return;
    currentIndex = idx;
    bg.style.filter = "blur(12px)";
    bg.style.opacity = "0";
    setTimeout(()=>{
      bg.style.backgroundImage = `url('${images[idx]}')`;
      bg.style.opacity = "1";
      bg.style.filter = "blur(0px)";
    },300);
  }

  function percentScroll(){
    const doc = document.documentElement;
    const max = doc.scrollHeight - doc.clientHeight;
    return max>0 ? (doc.scrollTop / max) * 100 : 0;
  }

  function update(){
    const p = percentScroll();
    const segment = 100 / n;              // taille d'un segment (%)
    const idx = Math.min(n-1, Math.floor(p / segment));
    changeBackground(idx);
  }

  window.addEventListener("scroll", ()=>requestAnimationFrame(update), {passive:true});
  window.addEventListener("load", ()=>{ update(); });
})();
</script>

</body>
</html>
